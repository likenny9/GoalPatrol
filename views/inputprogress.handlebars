<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Goal Patrol - Track Progress</title>
    <link href="../../../../css/bootstrap.css" rel="stylesheet">
    <link href="../../../../css/bootstrap-theme.css" rel="stylesheet">
    <link href="../../../../css/star-rating.min.css" rel="stylesheet">
    <!--<link href="css/GoalPatrol.css" rel="stylesheet">-->
    <script src="../../../../js/angular.1.2.26.min.js"></script>
    <script src="../../../../js/jquery-1.11.2.min.js"></script>
    <script src="../../../../js/bootstrap.min.js"></script>
    <script src="../../../../js/star-rating.min.js"></script>
    <script src="../../../../js/GoalPatrolScript.js"></script>

    <style type="text/css">
      /* Weird bug - with a font, stars show up as boxes */
      @font-face {
          font-family: 'LatoLight';
          src: url('../fonts/Lato/Lato-Regular.eot'); /* IE9 Compat Modes */
          src: url('../fonts/Lato/Lato-Regular.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
               url('../fonts/Lato/Lato-Regular.woff') format('woff'), /* Modern Browsers */
               url('../fonts/Lato/Lato-Regular.ttf') format('truetype'); 
          font-style: normal;
          font-weight: normal;
          text-rendering: optimizeLegibility;
      }

      * {
        -font-family: LatoLight;
        font-size: 1.6rem;
        color: black;
        margin: 0;
        padding: 0;
      }

      html {
          height: 100%;
          -position: relative;
          width: 100%;
        text-align: left;
      }

      body {
        background: -webkit-linear-gradient(rgba(0,70,230,0),rgba(0,70,230,0.3)); /* For Safari 5.1 to 6.0 */
          background: -o-linear-gradient(rgba(0,70,230,0),rgba(0,70,230,0.3)); /* For Opera 11.1 to 12.0 */
          background: -moz-linear-gradient(rgba(0,70,230,0),rgba(0,70,230,0.3)); /* For Firefox 3.6 to 15 */
        background: linear-gradient(rgba(0,70,230,0),rgba(0,70,230,0.3)); /* Standard syntax */
        background-repeat: no-repeat;
        background-attachment: fixed;
      }

      /* HOME HEADER */
      .header-container {
        width: 100%;
        -height: 10%;
        -border: 2px solid black;
      }

      .top {
        margin: -15px; 
        height: 60px;
        background: #D0D0F7;
        box-shadow: 0px 3px 5px #888888;
      }

      #title {
        color: #5E5EFF;
        font-size: 3rem;
        font-weight: bold;
        float: left;
        border-bottom: 1px inset blue;
        margin-left: 8px;
        background: -webkit-linear-gradient(#8787FF, #00007D);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
      }

      #dropdown-icon {
        float: right;
      }

      #dropdown-icon > h2 {
        font-size: 25px;
        font-weight: bold;
      }

      #dropdown-icon ul li a {
        font-size: 15px;
      }

      #sendgoal-icon {
        float: right;
        clear: right;
      }      


      /****** Rating ******/
      .text-tab {
        -display: block;
      }
      .star-rating {
        display: inline;
      }
      
      @media (max-width: 680px) {
        #dropdown-icon-mobile {
          display: block !important;
        }
        #mobile-name {
          display: block !important;
        }
      }

      @media (max-width: 680px) {
        #dropdown-icon {
          display: none !important;
        }
      }

      .row {
        margin-left: 0;
        margin-right: 0;
      }

    </style>

    <script>
    $(function() {

      //Randomly choose patial
      var randomPartial = $('#getPartial').attr('name');
      if(randomPartial == 1) {
        $('#originalPartial').css('display','block');
      }
      else {
        $('#newPartial').css('display', 'block');
      }

      function getMonthInWords(num) {
        var month = new Array(12);
        month[0]=  "January";
        month[1] = "February";
        month[2] = "March";
        month[3] = "April";
        month[4] = "May";
        month[5] = "June";
        month[6] = "July";
        month[7]=  "August";
        month[8] = "September";
        month[9] = "October";
        month[10] = "November";
        month[11] = "December";
        return month[num];
      }

      var today = new Date();
      today = getMonthInWords(today.getMonth()) + " " + today.getDate() + ", " + today.getFullYear();
      $('.today-date').html(today);

      //Displays empty form if nothing loaded from handlebars
      if($('#progress-form').length != 0) {
        console.log($('#progress-form').length);
        $('#empty-progress-form').css('display','none');
      }
      else {
        $('#empty-progress-form').css('display','block');
      }

      //Already have progress - user clicks submit
      $('#progress-form').submit(function(evt) {
        evt.preventDefault();

        var date = today;
        var difficulty = $('#difficulty-f')[0].value;
        var experience = $('#experience-f')[0].value;
        var satisfaction = $('#satisfaction-f')[0].value;
        var stress = $('#stress-f')[0].value;
        var comments = $('#notes-f')[0].value;

        var progressReport = {
          'date': new Date().toDateString(),
          'difficulty': difficulty,
          'experience': experience,
          'satisfaction': satisfaction,
          'stress': stress,
          'comments': comments,
          'patrol' : ""
        };

        progressReport = JSON.stringify(progressReport);

        insertProgressInfo(progressReport);
        
        function insertProgressInfo(data) {
          $.ajax({
            url: "/insertProgressInfo",
            method: "POST",
            data: data,
            contentType: "application/json",
            processdata: true
          }).done(function(data) {
            $.get('/getGoalID', goalID);
            function goalID(id) {
              window.location.href = '/trackprogress/' + id + '/track';              
            }
          });
        }

      });

      //No progress yet - user clicks submit
      $('#empty-progress-form').submit(function(evt) {
        evt.preventDefault();

        var date = new Date().toDateString();
        var difficulty = $('#difficulty')[0].value;
        var experience = $('#experience')[0].value;
        var satisfaction = $('#satisfaction')[0].value;
        var stress = $('#stress')[0].value;
        var comments = $('#notes')[0].value;

        var progressReport = {
          'date': new Date().toDateString(),
          'difficulty': difficulty,
          'experience': experience,
          'satisfaction': satisfaction,
          'stress': stress,
          'comments': comments,
          'goalInfoID' : ""
        };

        progressReport = JSON.stringify(progressReport);

        insertProgressInfo(progressReport);
        
        function insertProgressInfo(data) {
          $.ajax({
            url: "/insertProgressInfo",
            method: "POST",
            data: data,
            contentType: "application/json",
            processdata: true
          }).done(function(data) {
            $.get('/getGoalID', goalID);
            function goalID(id) {
              window.location.href = '/trackprogress/' + id + '/track';              
            }
          });
        }

      });

      //Cancel - goes back to track progress
      $('[id="cancel-btn"]').click(function(evt) {
        evt.preventDefault();

        $.get('/getGoalID', goalID);
        function goalID(data) {
           window.location.href = '/trackprogress/' + data + '/track';       
        }

      });

    });
    </script>
  </head>

  <body>

    <!-- Header: Title & Name -->
    <div class="header-container container" style="font-family: LatoLight">
      <div name="{{partial}}" id="getPartial" style="display: none"></div>
      <div class="top">
        <span id="originalPartial" style="display: none;">
          {{> headerOriginal}}
        </span>
        <span id="newPartial" style="display: none;">
          {{> header}}
        </span>
      </div>
      <div id="mobile-name" style="clear: left; float: left; margin-top: 15px; margin-left: 8px; display: none">
      Hi, {{#users}}{{name}}{{/users}}
      </div>
    </div>

    <br><!--Extra spacing-->

    <div class= "container">

      <h2 style="font-family: Calibri">Input Today's Progress</h2>

      <br>

      <!-- Empty form -->
      <form role="form" class="progress-forms" id="empty-progress-form">
        <div class="row">
          <div class="form-group">
            <p>Today is <span class="today-date" id="dateinput" style="font-weight: bold"></span></p>
          </div>
        </div>

        <div class="row">
          <div class="form-group">
            Difficulty
            <input type="number" id="difficulty" class="form-control input-lg rating-css rating" value={{difficulty}}>
          </div>
        </div>

        <div class="row">
          <div class="form-group">
            Experience
            <input type="number" id="experience" class="form-control input-lg rating-css rating" value={{experience}}>
          </div>
        </div>

        <div class="row">
          <div class="form-group">
            Satisfaction
            <input type="number" id="satisfaction" class="form-control input-lg rating-css rating" value={{satisfaction}}>
          </div>
        </div>
        <div class="row">
          <div class="form-group">
            Stress
            <input type="number" id="stress" class="form-control input-lg rating-css rating" value={{stress}}>
          </div>
        </div>
        <div class="row">
          <div class="form-group">
            <textarea type="text" id="notes" class="form-control" 
              rows="3" style="resize: none;" placeholder="Comments">{{comments}}</textarea>
          </div>
        </div>
        <h2><button class="btn btn-warning btn-block" type="submit">Submit Progress </button></h2>
        <h2><button id="cancel-btn" class="btn btn-danger btn-block" type="button">Cancel </button></h2>
      </form>

      <!-- Form for updating progress -->
      {{#progress}}
      <form role="form" class="progress-forms" id="progress-form">
        <div class="row">
          <div class="form-group">
            <p>Today is <span class="today-date" id="dateinput-f" style="font-weight: bold"></span></p>
          </div>
        </div>

        <div class="row">
          <div class="form-group">
            Difficulty
            <input type="number" id="difficulty-f" class="form-control input-lg rating-css rating" value={{difficulty}}>
          </div>
        </div>

        <div class="row">
          <div class="form-group">
            Experience
            <input type="number" id="experience-f" class="form-control input-lg rating-css rating" value={{experience}}>
          </div>
        </div>

        <div class="row">
          <div class="form-group">
            Satisfaction
            <input type="number" id="satisfaction-f" class="form-control input-lg rating-css rating" value={{satisfaction}}>
          </div>
        </div>
        <div class="row">
          <div class="form-group">
            Stress
            <input type="number" id="stress-f" class="form-control input-lg rating-css rating" value={{stress}}>
          </div>
        </div>
        <div class="row">
          <div class="form-group">
            <textarea type="text" id="notes-f" class="form-control" 
              rows="3" style="resize: none;" placeholder="Comments">{{comments}}</textarea>
          </div>
        </div>
        <h2><button class="btn btn-warning btn-block" type="submit" name="{{_id}}">Submit Progress </button></h2>
        <h2><button id="cancel-btn" class="btn btn-danger btn-block" type="button">Cancel </button></h2>
      </form>
      {{/progress}}
    </div>

    <script>
      $('.rating-css').rating({'size': 'xxs', 'showClear': false, 'showCaption': false, 'step': 1});       
    </script>
  </body>

</html>
